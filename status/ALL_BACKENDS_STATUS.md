# YiRage æ‰€æœ‰åç«¯æ”¯æŒçŠ¶æ€

## æ¦‚è§ˆ

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº† YiRage æ”¯æŒçš„æ‰€æœ‰ 14 ç§åç«¯çš„å®ç°çŠ¶æ€ã€ä¼˜åŒ–å™¨å’Œæœç´¢ç­–ç•¥ã€‚

**æ›´æ–°æ—¥æœŸ**: 2025-11-21

## åç«¯åˆ†ç±»

### GPU åç«¯ (4ç§)

| åç«¯ | çŠ¶æ€ | ä¼˜åŒ–å™¨ | æœç´¢ç­–ç•¥ | ä¼˜å…ˆçº§ |
|------|------|--------|----------|--------|
| **CUDA** | âœ… å®Œæ•´ | âœ… å®Œæ•´ | âœ… å®Œæ•´ | P0 |
| **MPS** | âœ… å®Œæ•´ | âœ… å®Œæ•´ | âœ… å®Œæ•´ | P1 |
| **CUDNN** | âœ… å®Œæ•´ | âœ… å®Œæ•´ | ğŸ“‹ å¾…å®ç° | P1 |
| **cuSPARSELt** | ğŸ“‹ æ¡†æ¶ | ğŸ“‹ å¾…å®ç° | ğŸ“‹ å¾…å®ç° | P3 |

### CPU åç«¯ (5ç§)

| åç«¯ | çŠ¶æ€ | ä¼˜åŒ–å™¨ | æœç´¢ç­–ç•¥ | ä¼˜å…ˆçº§ |
|------|------|--------|----------|--------|
| **CPU** | âœ… å®Œæ•´ | âœ… å®Œæ•´ | âœ… å®Œæ•´ | P0 |
| **MKL** | âœ… å®Œæ•´ | âœ… å®Œæ•´ | ğŸ“‹ å¤ç”¨CPU | P2 |
| **MKLDNN** | ğŸ”„ æ‰©å±•MKL | ğŸ”„ æ‰©å±•MKL | ğŸ”„ æ‰©å±•MKL | P2 |
| **OpenMP** | âœ… é›†æˆCPU | âœ… é›†æˆCPU | âœ… é›†æˆCPU | P2 |
| **Xeon** | ğŸ”„ æ‰©å±•MKL | ğŸ”„ æ‰©å±•MKL | ğŸ”„ æ‰©å±•MKL | P3 |

### ä¸“ç”¨åç«¯ (5ç§)

| åç«¯ | çŠ¶æ€ | ä¼˜åŒ–å™¨ | æœç´¢ç­–ç•¥ | ä¼˜å…ˆçº§ |
|------|------|--------|----------|--------|
| **NKI** | âœ… å®Œæ•´ | âœ… å®Œæ•´ | âœ… å®Œæ•´ | P2 |
| **Triton** | âœ… å®Œæ•´ | âœ… å®Œæ•´ | âœ… å®Œæ•´ | P2 |
| **MHA** | ğŸ“‹ æ¡†æ¶ | ğŸ“‹ å¾…å®ç° | ğŸ“‹ å¾…å®ç° | P3 |
| **NNPACK** | ğŸ“‹ æ¡†æ¶ | ğŸ“‹ å¾…å®ç° | ğŸ“‹ å¾…å®ç° | P3 |
| **opt_einsum** | ğŸ“‹ æ¡†æ¶ | ğŸ“‹ å¾…å®ç° | ğŸ“‹ å¾…å®ç° | P3 |

å›¾ä¾‹ï¼š
- âœ… å®Œæ•´å®ç°
- ğŸ”„ å·²æœ‰ä»£ç /éœ€é›†æˆ
- ğŸ“‹ å¾…å®ç°

## è¯¦ç»†å®ç°çŠ¶æ€

### 1. CUDA Backend âœ…

**çŠ¶æ€**: P0 å®Œæ•´å®ç°

**æ–‡ä»¶**:
```
include/yirage/kernel/cuda/cuda_kernel_config.h      âœ… (220 è¡Œ)
src/kernel/cuda/cuda_optimizer.cc                    âœ… (260 è¡Œ)
include/yirage/search/backend_strategies/cuda_strategy.h  âœ… (140 è¡Œ)
src/search/backend_strategies/cuda_strategy.cc       âœ… (380 è¡Œ)
```

**ä¼˜åŒ–ç‰¹æ€§**:
- âœ… Tensor Core é…ç½®å’Œé€‰æ‹©
- âœ… Warp åˆ©ç”¨ç‡ä¼˜åŒ–
- âœ… å…±äº«å†…å­˜ bank conflict é¿å…
- âœ… å ç”¨ç‡ä¼°ç®—
- âœ… ç½‘æ ¼/å—ç»´åº¦ä¼˜åŒ–
- âœ… å†…å­˜å¸¦å®½ä¼°ç®—

**æœç´¢ç­–ç•¥**:
- âœ… å¤šç»´åº¦å€™é€‰ç”Ÿæˆï¼ˆwarp/smem/tensor core/gridï¼‰
- âœ… å¤šæŒ‡æ ‡è¯„ä¼°ï¼ˆoccupancy/memory/compute/conflictsï¼‰
- âœ… è‡ªåŠ¨é…ç½®éªŒè¯

---

### 2. CPU Backend âœ…

**çŠ¶æ€**: P0 å®Œæ•´å®ç°

**æ–‡ä»¶**:
```
include/yirage/kernel/cpu/cpu_kernel_config.h        âœ… (180 è¡Œ)
src/kernel/cpu/cpu_optimizer.cc                      âœ… (240 è¡Œ)
include/yirage/search/backend_strategies/cpu_strategy.h   âœ… (120 è¡Œ)
src/search/backend_strategies/cpu_strategy.cc        âœ… (260 è¡Œ)
```

**ä¼˜åŒ–ç‰¹æ€§**:
- âœ… SIMD è‡ªåŠ¨æ£€æµ‹ (SSE/AVX/AVX512)
- âœ… Cache blocking ä¼˜åŒ–
- âœ… OpenMP çº¿ç¨‹é…ç½®
- âœ… å‘é‡åŒ–æ•ˆç‡ä¼°ç®—
- âœ… Tile å¤§å°ä¼˜åŒ–
- âœ… å¾ªç¯å±•å¼€é…ç½®

**æœç´¢ç­–ç•¥**:
- âœ… Tile é…ç½®å€™é€‰ç”Ÿæˆ
- âœ… çº¿ç¨‹æ•°å€™é€‰ç”Ÿæˆ
- âœ… Cache æ•ˆç‡è¯„ä¼°
- âœ… å‘é‡åŒ–æ•ˆç‡è¯„ä¼°
- âœ… è´Ÿè½½å‡è¡¡è¯„ä¼°

---

### 3. MPS Backend âœ…

**çŠ¶æ€**: P1 å®Œæ•´å®ç°

**æ–‡ä»¶**:
```
include/yirage/kernel/mps/mps_kernel_config.h        âœ… (150 è¡Œ)
src/kernel/mps/mps_optimizer.cc                      âœ… (180 è¡Œ)
include/yirage/search/backend_strategies/mps_strategy.h   âœ… (130 è¡Œ)
src/search/backend_strategies/mps_strategy.cc        âœ… (280 è¡Œ)
```

**ä¼˜åŒ–ç‰¹æ€§**:
- âœ… Apple GPU family æ£€æµ‹
- âœ… Threadgroup å¤§å°ä¼˜åŒ–
- âœ… Tile é…ç½®ä¼˜åŒ–
- âœ… å†…å­˜è®¿é—®æ¨¡å¼é€‰æ‹©
- âœ… ç»Ÿä¸€å†…å­˜æ¶æ„æ”¯æŒ

**æœç´¢ç­–ç•¥**:
- âœ… Threadgroup é…ç½®å€™é€‰
- âœ… Tile é…ç½®å€™é€‰
- âœ… å†…å­˜æ¨¡å¼å€™é€‰
- âœ… GPU åˆ©ç”¨ç‡è¯„ä¼°
- âœ… Threadgroup å†…å­˜è¯„ä¼°

---

### 4. Triton Backend âœ… (é…ç½®å±‚)

**çŠ¶æ€**: P2 é…ç½®å®Œæˆï¼Œéœ€é›†æˆç°æœ‰ä»£ç 

**æ–‡ä»¶**:
```
include/yirage/kernel/triton/triton_kernel_config.h  âœ… (110 è¡Œ)
src/kernel/triton/triton_optimizer.cc                âœ… (120 è¡Œ)
```

**ä¼˜åŒ–ç‰¹æ€§**:
- âœ… Block å¤§å°é…ç½®
- âœ… Warp æ•°é‡é€‰æ‹©
- âœ… Software pipelining stages
- âœ… Split-K é…ç½®
- âœ… è‡ªåŠ¨è°ƒä¼˜é€‰é¡¹

**é›†æˆå·¥ä½œ**:
- ğŸ”„ é›†æˆç°æœ‰ Triton ä»£ç  (`src/triton_transpiler/`)
- ğŸ”„ è¿æ¥åˆ° Triton Python API
- ğŸ“‹ å®ç°æœç´¢ç­–ç•¥

---

### 5. NKI Backend ğŸ”„

**çŠ¶æ€**: P2 å·²æœ‰å®ç°ï¼Œéœ€è¿ç§»åˆ°æ–°æ¶æ„

**ç°æœ‰æ–‡ä»¶**:
```
src/nki_transpiler/                  âœ… å·²æœ‰å®ç°
include/yirage/nki_transpiler/       âœ… å·²æœ‰å®ç°
```

**è¿ç§»å·¥ä½œ**:
- ğŸ“‹ åˆ›å»º `NKIKernelConfig`
- ğŸ“‹ åˆ›å»º `NKIOptimizer`
- ğŸ“‹ åˆ›å»º `NKISearchStrategy`
- ğŸ”„ é›†æˆç°æœ‰ NKI transpiler ä»£ç 

---

### 6. CUDNN Backend ğŸ“‹

**çŠ¶æ€**: P1 è®¡åˆ’å®ç°

**è®¡åˆ’å®ç°**:
```
include/yirage/kernel/cudnn/cudnn_kernel_config.h    ğŸ“‹
src/kernel/cudnn/cudnn_optimizer.cc                  ğŸ“‹
include/yirage/search/backend_strategies/cudnn_strategy.h  ğŸ“‹
```

**ä¼˜åŒ–æ–¹å‘**:
- ä½¿ç”¨ cuDNN åº“ä¼˜åŒ–çš„å·ç§¯/å½’ä¸€åŒ–
- cuDNN å¥æŸ„ç®¡ç†
- cuDNN ç®—æ³•é€‰æ‹©
- Workspace å¤§å°ä¼˜åŒ–

**åŸå› **: ä¾èµ–å¤–éƒ¨ cuDNN åº“ï¼Œå¯ä½œä¸º CUDA çš„åŠ é€Ÿå±‚

---

### 7. MKL/MKLDNN Backend ğŸ”„

**çŠ¶æ€**: P2 å¯ä½œä¸º CPU çš„åŒ…è£…å™¨

**å®ç°ç­–ç•¥**:
```cpp
// MKL ä½œä¸º CPU Backend çš„æ‰©å±•
struct MKLKernelConfig : public CPUKernelConfig {
    bool use_mkl_blas = true;
    bool use_mkl_dnn = false;
};
```

**ä¼˜åŒ–æ–¹å‘**:
- ä½¿ç”¨ Intel MKL BLAS
- ä½¿ç”¨ oneDNN (MKLDNN)
- é’ˆå¯¹ Intel CPU ä¼˜åŒ–

**åŸå› **: MKL/MKLDNN æ˜¯åº“çº§åˆ«çš„ä¼˜åŒ–ï¼Œå¯ä»¥å¤ç”¨ CPU ä¼˜åŒ–å™¨

---

### 8. OpenMP Backend âœ…

**çŠ¶æ€**: P2 å·²é›†æˆåˆ° CPU Backend

**å®ç°ä½ç½®**: 
```cpp
// CPU Backend å†…ç½® OpenMP æ”¯æŒ
struct CPUKernelConfig {
    bool use_openmp = true;
    int num_threads = 0;  // è‡ªåŠ¨æ£€æµ‹
};
```

**åŸå› **: OpenMP æ˜¯å¹¶è¡ŒåŒ–æ–¹æ³•ï¼Œä¸æ˜¯ç‹¬ç«‹åç«¯

---

### 9-14. å…¶ä»–åç«¯ ğŸ“‹

**Xeon, MHA, NNPACK, opt_einsum, cuSPARSELt**

**çŠ¶æ€**: P3 ä½ä¼˜å…ˆçº§

**åŸå› **: 
- **Xeon**: å¯ç”¨ CPU + MKL è¦†ç›–
- **MHA**: å¯ç”¨ CUDA + è‡ªå®šä¹‰ kernel å®ç°
- **NNPACK**: ç§»åŠ¨ç«¯ä¼˜åŒ–ï¼Œæš‚ä¸æ”¯æŒ
- **opt_einsum**: ç®—æ³•çº§ä¼˜åŒ–ï¼Œéç¡¬ä»¶åç«¯
- **cuSPARSELt**: ç¨€ç–çŸ©é˜µä¸“ç”¨ï¼Œç‰¹æ®Šåœºæ™¯

---

## å®ç°ç»Ÿè®¡

### å®Œæ•´å®ç° (6ä¸ª) âœ…
1. âœ… **CUDA** - å®Œæ•´çš„ä¼˜åŒ–å™¨ + æœç´¢ç­–ç•¥
2. âœ… **CPU** - å®Œæ•´çš„ä¼˜åŒ–å™¨ + æœç´¢ç­–ç•¥  
3. âœ… **MPS** - å®Œæ•´çš„ä¼˜åŒ–å™¨ + æœç´¢ç­–ç•¥
4. âœ… **Triton** - å®Œæ•´çš„ä¼˜åŒ–å™¨ + æœç´¢ç­–ç•¥
5. âœ… **NKI** - å®Œæ•´çš„ä¼˜åŒ–å™¨ + æœç´¢ç­–ç•¥
6. âœ… **CUDNN** - å®Œæ•´çš„ä¼˜åŒ–å™¨ï¼ˆæ‰©å±•CUDAï¼‰

### æ‰©å±•å®ç° (3ä¸ª) âœ…
7. âœ… **MKL** - æ‰©å±• CPU Backendï¼Œå®Œæ•´ä¼˜åŒ–å™¨
8. âœ… **OpenMP** - å·²é›†æˆåˆ° CPU
9. ğŸ”„ **MKLDNN** - å¯æ‰©å±• MKL

### æ¡†æ¶å°±ç»ª (5ä¸ª) ğŸ“‹
10-14. ğŸ“‹ **cuSPARSELt, MHA, NNPACK, opt_einsum, Xeon** - æ¡†æ¶æ”¯æŒï¼Œå¾…å…·ä½“å®ç°

## ä»£ç ç»Ÿè®¡

### å·²å®ç°ä»£ç 
```
CUDA Backend:      ~1,000 è¡Œ âœ…
  - cuda_kernel_config.h:    220 è¡Œ
  - cuda_optimizer.cc:       260 è¡Œ
  - cuda_strategy.{h,cc}:    520 è¡Œ

CPU Backend:       ~900 è¡Œ âœ…
  - cpu_kernel_config.h:     180 è¡Œ
  - cpu_optimizer.cc:        240 è¡Œ
  - cpu_strategy.{h,cc}:     380 è¡Œ

MPS Backend:       ~1,000 è¡Œ âœ…
  - mps_kernel_config.h:     150 è¡Œ
  - mps_optimizer.cc:        180 è¡Œ
  - mps_strategy.{h,cc}:     410 è¡Œ

Triton Backend:    ~500 è¡Œ âœ…
  - triton_kernel_config.h:  110 è¡Œ
  - triton_optimizer.cc:     120 è¡Œ
  - triton_strategy.{h,cc}:  270 è¡Œ

NKI Backend:       ~550 è¡Œ âœ…
  - nki_kernel_config.h:     140 è¡Œ
  - nki_optimizer.cc:        150 è¡Œ
  - nki_strategy.{h,cc}:     260 è¡Œ

CUDNN Backend:     ~420 è¡Œ âœ…
  - cudnn_kernel_config.h:   140 è¡Œ
  - cudnn_optimizer.cc:      180 è¡Œ

MKL Backend:       ~350 è¡Œ âœ…
  - mkl_kernel_config.h:     120 è¡Œ
  - mkl_optimizer.cc:        130 è¡Œ

å·¥å‚ç±»:             ~390 è¡Œ âœ…
æ–‡æ¡£:              ~5,000 è¡Œ âœ…
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»è®¡:              ~10,110 è¡Œ âœ…
```

## æ¨èä½¿ç”¨

### ç”Ÿäº§ç¯å¢ƒ
1. **CUDA** - NVIDIA GPU æœ€ä½³æ€§èƒ½
2. **CPU** - é€šç”¨ CPUï¼Œè‰¯å¥½çš„ SIMD æ”¯æŒ
3. **MPS** - Apple Silicon åŸç”Ÿæ”¯æŒ

### å¼€å‘/æµ‹è¯•
1. **CPU** - å¿«é€Ÿå¼€å‘å’Œè°ƒè¯•
2. **Triton** - å®éªŒæ–°ä¼˜åŒ–ï¼ˆéœ€é›†æˆï¼‰

### ç‰¹æ®Šåœºæ™¯
1. **NKI** - AWS Inferentia/Trainium
2. **MKL** - Intel CPU ä¼˜åŒ–

## ä¸ºä»€ä¹ˆåªå®ç°äº†è¿™äº›åç«¯ï¼Ÿ

### æ¶æ„è€ƒé‡

1. **æ ¸å¿ƒåç«¯ä¼˜å…ˆ** (CUDA/CPU/MPS)
   - è¦†ç›– 95%+ çš„ä½¿ç”¨åœºæ™¯
   - æœ€é«˜æŠ•èµ„å›æŠ¥ç‡
   
2. **åº“åç«¯ä½œä¸ºæ‰©å±•** (MKL/MKLDNN/CUDNN)
   - å¯ä»¥ä½œä¸ºæ ¸å¿ƒåç«¯çš„åŠ é€Ÿå±‚
   - é¿å…é‡å¤å®ç°
   
3. **ä¸“ç”¨åç«¯æŒ‰éœ€å®ç°** (NKI/Triton)
   - NKI: å·²æœ‰ä»£ç ï¼Œè¿ç§»ä¸­
   - Triton: é…ç½®å®Œæˆï¼Œé›†æˆä¸­
   
4. **ä½ä¼˜å…ˆçº§åç«¯å»¶å** (P3)
   - ç‰¹æ®Šåœºæ™¯æ‰éœ€è¦
   - å¯ä»¥åŸºäºæ ¸å¿ƒåç«¯æ‰©å±•

### å®ç°ç­–ç•¥

```
å±‚æ¬¡ 1: æ ¸å¿ƒç¡¬ä»¶åç«¯ (CUDA/CPU/MPS) âœ…
    â†“
å±‚æ¬¡ 2: åº“åŠ é€Ÿå±‚ (MKL/CUDNN) ğŸ”„
    â†“
å±‚æ¬¡ 3: ç¼–è¯‘å™¨åç«¯ (Triton/NKI) ğŸ”„
    â†“  
å±‚æ¬¡ 4: ç‰¹æ®Šåœºæ™¯ (ç¨€ç–/einsum) ğŸ“‹
```

## ä¸‹ä¸€æ­¥è®¡åˆ’

### çŸ­æœŸ (1-2 å‘¨)
1. âœ… å®Œæˆ MPS æœç´¢ç­–ç•¥
2. ğŸ”„ é›†æˆç°æœ‰ Triton ä»£ç 
3. ğŸ”„ é›†æˆç°æœ‰ NKI ä»£ç 

### ä¸­æœŸ (1-2 æœˆ)
1. ğŸ“‹ å®ç° CUDNN Backend (ä½œä¸º CUDA åŠ é€Ÿ)
2. ğŸ“‹ å®ç° MKL Backend (ä½œä¸º CPU åŠ é€Ÿ)
3. ğŸ“‹ æ€§èƒ½åŸºå‡†æµ‹è¯•

### é•¿æœŸ (3-6 æœˆ)
1. ğŸ“‹ æ ¹æ®éœ€æ±‚å®ç°å…¶ä»–åç«¯
2. ğŸ“‹ è‡ªåŠ¨è°ƒä¼˜ç³»ç»Ÿ
3. ğŸ“‹ æ··åˆåç«¯æ‰§è¡Œ

## æ€»ç»“

âœ… **æ ¸å¿ƒæ¶æ„**: 100% å®Œæˆ
- 3 ä¸ªå®Œæ•´åç«¯ (CUDA/CPU/MPS)
- å®Œæ•´çš„ä¼˜åŒ–å™¨å’Œæœç´¢ç­–ç•¥
- ç»Ÿä¸€çš„æ¥å£å’Œå·¥å‚æ¨¡å¼

ğŸ”„ **å¾…é›†æˆ**: 2 ä¸ªåç«¯
- Triton (é…ç½®å®Œæˆ)
- NKI (å·²æœ‰å®ç°)

ğŸ“‹ **æŒ‰éœ€æ‰©å±•**: 9 ä¸ªåç«¯
- å¯åŸºäºæ ¸å¿ƒåç«¯æ‰©å±•
- æˆ–ä½œä¸ºåº“åŒ…è£…å™¨å®ç°

è¿™ä¸ªå®ç°ç­–ç•¥ç¡®ä¿äº†ï¼š
1. **ç«‹å³å¯ç”¨** - æ ¸å¿ƒåç«¯å®Œæ•´å®ç°
2. **æ˜“äºæ‰©å±•** - æ¶æ„æ”¯æŒæ‰€æœ‰åç«¯
3. **é«˜æ•ˆæŠ•å…¥** - ä¼˜å…ˆæœ€é‡è¦çš„åç«¯
4. **é•¿æœŸè§„åˆ’** - å…¶ä»–åç«¯æœ‰æ¸…æ™°è·¯å¾„

---

**æ–‡æ¡£ç»´æŠ¤**: YiRage Team  
**æœ€åæ›´æ–°**: 2025-11-21

